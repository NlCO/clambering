<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout.html}">
<head>
    <title>Spot</title>
    <link rel="stylesheet" type="text/css" href="/webjars/leaflet/1.5.1/leaflet.css" integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ==" crossorigin="">
    <!-- Make sure you put this AFTER Leaflet's CSS -->
    <script src="/webjars/leaflet/1.5.1/leaflet.js"></script>
</head>
<body>

<main layout:fragment="content" class="container ">

    <div class="jumbotron m-2">
        <h5 class="text-center"><span th:class="'flag-icon flag-icon-' + ${spot.region.pays.code} + ' pr-5'"></span><span th:utext="${spot.region.pays.nom}"></span> - <span th:utext="${spot.region.nom}"></span> </h5>
        <h1 th:utext=" ${spot.nom}" class="text text-center"></h1>
        <p th:text="${spot.description}" class="text text-center text-justify">...</p>
    </div>

    <div class="row m-2">
        <div class="col-lg-4 mb-2 mb-lg-0">
            <div class="card rounded">
                <div class="card-header"><h5>Informations générales</h5></div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table w-100">
                            <tbody>
                            <tr><td>Nombre de secteurs</td><td class="text-center"><span th:utext="${spot.secteurs.size()}"></span></td></tr>
                                <tr th:object="${spot.secteurs}"><td>Nombre de voies</td><td class="text-center"><span th:utext="${#aggregates.sum(#object.![voies.size()])}"></span></td></tr>
                                <tr><td>Orientation</td><td class="text-center"><span th:utext="${spot.orientation}"></span></td></tr>
                                <tr><td>Hauteur Minimum</td><td class="text-center"><span th:utext="${spot.getHauteurMin()}"></span> m</td></tr>
                                <tr><td>Hauteur Maximum</td><td class="text-center"><span th:utext="${spot.getHauteurMax()}"></span> m</td></tr>
                                <tr><td>Cotation Minimum</td><td class="text-center"><span th:utext="${spot.getCotationMin()}"></span></td></tr>
                                <tr><td>Cotation Maximum</td><td class="text-center"><span th:utext="${spot.getCotationMax()}"></span></td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-8">
            <div class="container-fluid p-0">
                <div class="card rounded w-100 mb-2">
                    <div class="card-header"><h5>Accès au site</h5></div>
                    <div class="card-body"><span th:utext="${spot.acces}"></span></div>
                </div>
                <div class="card rounded w-100">
                    <div class="card-header"><h5>Map</h5></div>
                    <div class="card-body" id="mapid" style="height: 25em"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="container-fluid p-0" >
        <div class="card">
            <div class="card-header"><h5>Informations détaillées des secteurs</h5></div>
            <div class="card-body p-0">
                <div id="accordion">
                    <div th:each ="secteur : ${spot.secteurs}" class="card">
                        <div class="card-header">
                            <a class="card-link" data-toggle="collapse" th:attr="href='#collapseSecteurId_'+${secteur.secteurId}">
                                <span th:utext="${secteur.nom}">...</span>
                            </a>
                        </div>
                        <div th:attr="id='collapseSecteurId_'+${secteur.secteurId}" class="collapse" data-parent="#accordion">
                            <div class="card-body">
                                <p><b>Informations : </b><span th:utext="${secteur.description}"></span></p>
                                <div class="table-responsive">
                                    <table class="table table-borderless text-center">
                                        <thead>
                                        <th class="text-left">nom de la voie</th>
                                        <th>longueur</th>
                                        <th>hauteur</th>
                                        <th>dégaines</th>
                                        <th>cotation min</th>
                                        <th>cotation max</th>
                                        </thead>
                                        <tbody>
                                        <tr th:each="voie : ${secteur.voies}">
                                            <td class="text-left" th:utext="${voie.nom}"></td>
                                            <td th:utext="${voie.longueurs.size()}"></td>
                                            <td><span th:utext="${#numbers.formatDecimal(#aggregates.sum(voie.longueurs.![hauteur]),1,2,'COMMA')}"></span> m</td>
                                            <td th:utext="${#aggregates.sum(voie.longueurs.![degaine])}"></td>
                                            <td th:utext="${voie.cotationMin}"></td>
                                            <td th:utext="${voie.cotationMax}"></td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script th:inline="javascript">

        var lat = /*[[${spot.latitude}]]*/;
        var lon = /*[[${spot.longitude}]]*/;

        var mymap = L.map('mapid').setView([lat, lon], 10);

        L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
            maxZoom: 18,
            attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
                '<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
                'Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
            id: 'mapbox.outdoors'
        }).addTo(mymap);

        L.marker([lat, lon]).addTo(mymap);


        var popup = L.popup();

    </script>
</main>


</body>
</html>